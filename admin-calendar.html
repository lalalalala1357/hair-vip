<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¡Œäº‹æ›†ç®¡ç† - å¯è‰å…’ Hair Salon</title>
<style>
body { font-family: Arial, sans-serif; background:#f9fff9; margin:0; padding:0; }
header { background:#a8e6cf; padding:20px; text-align:center; color:#4a7c53; font-weight:bold; }
nav ul { list-style:none; display:flex; gap:15px; justify-content:center; margin:15px 0 0 0; padding:0; }
nav a { text-decoration:none; color:#333; font-weight:bold; padding:6px 10px; border-radius:4px; }
nav a:hover, nav a.active { background:#7bd8a2; color:#fff; }
#controls { text-align:center; margin:20px 0; }
#calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:2px; max-width:700px; margin:0 auto; }
.week-cell, .calendar-cell { padding:10px; border:1px solid #ccc; text-align:center; }
.week-cell { background:#e0f2e9; font-weight:bold; }
.calendar-cell { background:#fff; cursor:pointer; position:relative; }
.calendar-cell:hover { background:#7bd8a2; color:#fff; }
.label { position:absolute; top:4px; right:4px; background:#ff5c5c; color:#fff; font-size:0.7rem; padding:2px 4px; border-radius:3px; }
button { margin:0 5px; padding:6px 12px; background:#7bd8a2; border:none; color:#fff; border-radius:4px; cursor:pointer; }
button:hover { background:#5bb174; }
</style>
</head>
<body>

<header>
å¯è‰å…’ Hair Salon - è¡Œäº‹æ›†ç®¡ç†
<nav>
<ul>
<li><a href="vip.html">VIP ç®¡ç†</a></li>
<li><a href="admin-calendar.html" class="active">è¡Œäº‹æ›†ç®¡ç†</a></li>
</ul>
</nav>
</header>

<div id="controls">
<button id="prevMonth">ä¸Šå€‹æœˆ</button>
<span id="monthLabel" style="font-weight:bold; margin:0 15px;"></span>
<button id="nextMonth">ä¸‹å€‹æœˆ</button>
<button id="exportBtn">åŒ¯å‡º JSON</button>
<button id="importBtn">åŒ¯å…¥ JSON</button>
<button id="refreshBtn">é‡æ–°æ•´ç†</button>
</div>

<div id="calendar"></div>
<input type="file" id="importFile" style="display:none" accept=".json">

<script>
const STORAGE_KEY_CAL = 'salon_calendar_appointments_v3';
const STORAGE_KEY_VIP = 'salon_vip_list';
const STORAGE_KEY_AUTH = 'calendar_authenticated';

let appointments = JSON.parse(localStorage.getItem(STORAGE_KEY_CAL)||'{}');
let vipList = JSON.parse(localStorage.getItem(STORAGE_KEY_VIP)||'[]');

let today = new Date();
let currentYear = today.getFullYear();
let currentMonth = today.getMonth();
const weekDays = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];

function buildCalendar(year, month){
  const calendar = document.getElementById('calendar');
  calendar.innerHTML='';
  document.getElementById('monthLabel').textContent=`${year} å¹´ ${month+1} æœˆ`;

  weekDays.forEach(d=>{
    const cell=document.createElement('div');
    cell.classList.add('week-cell');
    cell.textContent=d;
    calendar.appendChild(cell);
  });

  const firstDay=new Date(year,month,1);
  const lastDay=new Date(year,month+1,0);
  const startWeek=firstDay.getDay();
  const totalDays=lastDay.getDate();

  for(let i=0;i<startWeek;i++){
    const cell=document.createElement('div');
    cell.classList.add('calendar-cell');
    cell.style.background='#f0f0f0';
    calendar.appendChild(cell);
  }

  for(let d=1; d<=totalDays; d++){
    const dayStr=`${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const cell=document.createElement('div');
    cell.classList.add('calendar-cell');
    cell.textContent=d;

    if(appointments[dayStr] && appointments[dayStr].length>0){
      const label = document.createElement('div');
      label.classList.add('label');
      let count = appointments[dayStr].length;

      // ä¿®æ­£ VIP åˆ¤æ–·
      const hasVIP = appointments[dayStr].some(a => vipList.some(v => v.phone === a.phone));
      label.textContent = hasVIP ? `â˜…${count}` : count;

      cell.appendChild(label);
    }

    cell.addEventListener('click', ()=>manageDay(dayStr));
    calendar.appendChild(cell);
  }
}

function manageDay(dayStr){
  const dayAppointments = appointments[dayStr] || [];
  let msg = `ğŸ“… ${dayStr} çš„é ç´„:\n\n`;
  dayAppointments.forEach((a,i)=>{
    // ä¿®æ­£ VIP åˆ¤æ–·
    let star = vipList.some(v => v.phone === a.phone) ? ' â˜…VIP' : '';
    msg+=`${i+1}. ${a.time} - ${a.name} (${a.phone})${star}\n æœå‹™: ${a.service}\n`;
  });
  msg+='\nè¼¸å…¥:\n1 = æ–°å¢é ç´„\n2 = åˆªé™¤é ç´„\nå–æ¶ˆ = é›¢é–‹';
  const action = prompt(msg);
  if(action==='1'){
    const name=prompt('å§“å:'); if(!name) return;
    const phone=prompt('é›»è©±:'); if(!phone) return;
    const service=prompt('æœå‹™é …ç›®:'); if(!service) return;
    const time=prompt('æ™‚é–“ (ä¾‹å¦‚ 10:00):'); if(!time) return;
    if(!appointments[dayStr]) appointments[dayStr]=[];
    appointments[dayStr].push({name, phone, service, time});
    localStorage.setItem(STORAGE_KEY_CAL, JSON.stringify(appointments));
    buildCalendar(currentYear,currentMonth);
  } else if(action==='2'){
    if(dayAppointments.length===0){ alert('ç„¡é ç´„å¯åˆª'); return; }
    let delMsg='è¼¸å…¥è¦åˆªé™¤çš„ç·¨è™Ÿ:\n';
    dayAppointments.forEach((a,i)=>{
      delMsg+=`${i+1}. ${a.time} - ${a.name} (${a.phone})\n`;
    });
    const delIndex=parseInt(prompt(delMsg))-1;
    if(!isNaN(delIndex) && dayAppointments[delIndex]){
      dayAppointments.splice(delIndex,1);
      if(dayAppointments.length===0) delete appointments[dayStr];
      localStorage.setItem(STORAGE_KEY_CAL, JSON.stringify(appointments));
      buildCalendar(currentYear,currentMonth);
    }
  }
}

document.getElementById('prevMonth').addEventListener('click', ()=>{
  currentMonth--; if(currentMonth<0){ currentMonth=11; currentYear--; }
  buildCalendar(currentYear,currentMonth);
});
document.getElementById('nextMonth').addEventListener('click', ()=>{
  currentMonth++; if(currentMonth>11){ currentMonth=0; currentYear++; }
  buildCalendar(currentYear,currentMonth);
});
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const dataStr = "data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(appointments,null,2));
  const dlAnchor = document.createElement('a');
  dlAnchor.setAttribute("href", dataStr);
  dlAnchor.setAttribute("download","appointments.json");
  dlAnchor.click();
});
document.getElementById('importBtn').addEventListener('click', ()=>{
  document.getElementById('importFile').click();
});
document.getElementById('importFile').addEventListener('change', (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(evt){
    try{
      appointments = JSON.parse(evt.target.result);
      localStorage.setItem(STORAGE_KEY_CAL, JSON.stringify(appointments));
      buildCalendar(currentYear,currentMonth);
      alert('åŒ¯å…¥æˆåŠŸï¼');
    }catch(err){ alert('æª”æ¡ˆæ ¼å¼éŒ¯èª¤'); }
  }
  reader.readAsText(file);
});
document.getElementById('refreshBtn').addEventListener('click', ()=>{
  appointments = JSON.parse(localStorage.getItem(STORAGE_KEY_CAL)||'{}');
  vipList = JSON.parse(localStorage.getItem(STORAGE_KEY_VIP)||'[]');
  buildCalendar(currentYear,currentMonth);
});

if(!localStorage.getItem(STORAGE_KEY_AUTH)){
  const password = prompt('è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼');
  if(password==='salon2025'){
    localStorage.setItem(STORAGE_KEY_AUTH,'true');
    buildCalendar(currentYear,currentMonth);
  } else {
    alert('å¯†ç¢¼éŒ¯èª¤ï¼');
    document.body.innerHTML='<h2 style="text-align:center;margin-top:100px;">å¯†ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•é€²å…¥è¡Œäº‹æ›†</h2>';
  }
} else {
  buildCalendar(currentYear,currentMonth);
}
</script>

</body>
</html>
